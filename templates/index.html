<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>俺専用ラーメンアプリ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>🍜 俺専用ラーメンアプリ</h1>
            <p>ラーメン写真に店名ラベルを追加</p>
        </header>

        <main>
            <!-- 写真アップロード -->
            <section id="upload-section">
                <!-- カメラ撮影用 -->
                <input type="file" accept="image/*" id="camera-input" capture="environment"
                    style="opacity: 0; position: absolute; z-index: -1;">
                <!-- ライブラリ選択用（captureなし） -->
                <input type="file" accept="image/*" id="library-input"
                    style="opacity: 0; position: absolute; z-index: -1;">

                <div class="upload-buttons">
                    <label for="camera-input" class="upload-btn camera-btn">
                        <span class="btn-icon">📸</span>
                        <span class="btn-label">カメラ撮影</span>
                    </label>
                    <label for="library-input" class="upload-btn library-btn">
                        <span class="btn-icon">🖼️</span>
                        <span class="btn-label">写真を選択</span>
                    </label>
                </div>

                <label for="library-input" class="drop-zone" id="drop-zone">
                    <div class="drop-zone-content">
                        <p>または写真をここにドラッグ＆ドロップ</p>
                    </div>
                </label>
            </section>

            <!-- 処理中 -->
            <div id="loading" class="hidden">
                <div class="auto-progress">
                    <div class="spinner"></div>
                    <p id="step-status">処理中...</p>
                </div>
            </div>

            <!-- Step 1: 切り抜き編集画面 -->
            <section id="crop-section" class="hidden">
                <h2>✂️ どんぶりギリギリで切り抜け</h2>
                <p class="crop-instruction">AI検知で枠を自動セット済み / 微調整も可能</p>

                <!-- 切り抜き座標モニター -->
                <div id="crop-coords" class="crop-coords">
                    <span id="coord-status" class="coord-waiting">⏳ 検知中...</span>
                    <span id="coord-values">X:0 Y:0 W:0 H:0</span>
                </div>

                <div class="cropper-wrapper" id="cropper-wrapper">
                    <img id="crop-preview" src="" alt="Crop Preview">
                </div>
                <div class="crop-actions">
                    <button id="crop-done-btn" class="primary" disabled>⏳ どんぶり検知中...</button>
                    <button id="crop-cancel-btn" class="secondary">キャンセル</button>
                </div>
            </section>

            <!-- Step 2: 店名入力画面 -->
            <section id="edit-section" class="hidden">
                <h2>📝 店名を入力</h2>
                <div class="preview-container">
                    <img id="preview-image" src="" alt="Cropped Image">
                </div>
                <div class="edit-form">
                    <label for="shop-name">店名</label>
                    <input type="text" id="shop-name" placeholder="店名を入力してください">
                    <p class="hint" id="edit-hint">💡 下のリストから店名をタップで反映できます</p>
                    <button id="save-btn" class="primary">💾 この店名で保存</button>
                    <button id="back-btn" class="secondary">← 戻る</button>
                </div>
            </section>

            <!-- 保存完了画面 -->
            <section id="result-section" class="hidden">
                <h2>✅ 保存完了！</h2>
                <div class="result-container">
                    <img id="result-image" src="" alt="Result">
                </div>
                <div class="result-info">
                    <p class="result-shop-name" id="result-shop-name"></p>
                </div>
                <div class="result-buttons">
                    <a id="download-link" href="#" download class="button primary">💾 ダウンロード</a>
                    <a id="share-btn" href="#" class="button share-btn">📤 共有</a>
                    <button id="reset-btn" class="secondary">🍜 もう一杯</button>
                </div>
            </section>

            <!-- 新店情報 -->
            <section id="news-section" class="news-section">
                <div class="section-header">
                    <h2>🍜 北関東 最新オープン情報</h2>
                    <p class="section-subtitle">📍 ナビボタンでGoogleマップが起動します</p>
                </div>
                <div id="shop-container" class="shop-container">
                    <div class="loading-state">
                        <div class="spinner-small"></div>
                        <p>情報を取得中...</p>
                    </div>
                </div>
            </section>

        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/blueimp-load-image@5.16.0/js/load-image.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.js"></script>
    <script src="/static/js/main.js"></script>
</body>

</html>
